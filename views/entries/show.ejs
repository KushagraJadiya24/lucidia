<% layout('layouts/boilerplate') %>

<div class="container old_entry mt-5">
  <div class="new-entry-header text-center mb-5 animate-entry">
    <h1 class="display-5 fw-bold gradient-heading"><%= entry.title %></h1>
  </div>

  <!-- Combined Form Container -->
  <div class="new-entry-form">
    <!-- UPDATE FORM -->
    <form id="updateForm" action="/entries/<%= entry._id %>?_method=PATCH" method="POST" class="mb-3">
      <!-- Quill Editor Container -->
      <div id="editor" style="height: 300px;"></div>

      <!-- Hidden Textarea to hold Quill content -->
      <textarea name="content" id="content" hidden><%- entry.content %></textarea>

      <div class="d-flex justify-content-start flex-wrap gap-2 align-items-center mt-3">
        <input type="text" name="title" class="form-control old-journal-title-input w-50" value="<%= entry.title %>" required>
        <button type="submit" class="btn journal-btn">Update Entry</button>
        
        <!-- DELETE BUTTON - Now beside Update -->
        <button type="button" class="btn btn-danger" 
                onclick="if(confirm('Are you sure you want to delete this entry?')) { document.getElementById('deleteForm').submit(); }">
          Delete
        </button>
      </div>
    </form>

    <!-- Hidden DELETE FORM -->
    <form id="deleteForm" action="/entries/<%= entry._id %>?_method=DELETE" method="POST" style="display: none;"></form>
  </div>
</div>

<!-- Include Quill CSS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

<!-- Quill Setup Script -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize Quill
    const quill = new Quill('#editor', {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline'],
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          ['link']
        ]
      }
    });

    // Load existing content
    const existingContent = document.querySelector('#content').value;
    if (existingContent) {
      quill.root.innerHTML = existingContent;
    }

    // Handle form submission
    document.getElementById('updateForm').addEventListener('submit', function(e) {
      document.getElementById('content').value = quill.root.innerHTML;
      return true;
    });
  });
</script>